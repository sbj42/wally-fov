var WallyFov=function(t){function e(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,r){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/bin/",e(e.s=9)}([function(t,e,i){"use strict";function r(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),r(i(3)),r(i(2)),r(i(6)),r(i(8)),r(i(7)),r(i(5)),r(i(4))},function(t,e,i){"use strict";function r(t,e,i,n){for(;;){if(e===t.length)return e;if(i<=t[e+u])break;e+=h}if(i<=t[e+s]){if(n>=t[e+u])return t.splice(e,h),r(t,e,i,n);n>=t[e+s]&&(t[e+s]=n)}else{if(n>=t[e+u])return t[e+u]=i,e+=h,r(t,e,i,n);t.splice(e,0,t[e+s],i),e+=h,t[e+s]=n}return e}Object.defineProperty(e,"__esModule",{value:!0});var n,o=i(0);!function(t){t[t.WALL_NORTH=1]="WALL_NORTH",t[t.WALL_EAST=2]="WALL_EAST",t[t.WALL_WEST=8]="WALL_WEST",t[t.WALL_SOUTH=4]="WALL_SOUTH",t[t.BODY=1<<o.DIRECTIONS.length]="BODY"}(n||(n={}));var s=0,u=1,h=2,c=new o.Offset,f=function(){function t(t,e){this._size=new o.Size,this._size.set(t,e),this._tileFlags=new Array(this._size.area).fill(0)}return t.prototype._addFlag=function(t,e){var i=this._size.index(t);this._tileFlags[i]|=e},t.prototype._removeFlag=function(t,e){var i=this._size.index(t);this._tileFlags[i]&=~e},t.prototype.addWall=function(t,e,i){c.set(t,e).addCardinalDirection(i),this._size.containsOffset(c)&&(this._addFlag(c,1<<o.directionOpposite(i)),c.set(t,e),this._addFlag(c,1<<i))},t.prototype.removeWall=function(t,e,i){c.set(t,e).addCardinalDirection(i),this._size.containsOffset(c)&&(this._removeFlag(c,1<<o.directionOpposite(i)),c.set(t,e),this._removeFlag(c,1<<i))},t.prototype.getWalls=function(t,e){c.set(t,e);var i=this._size.index(c);return this._tileFlags[i]&o.DirectionFlags.ALL},t.prototype.addBody=function(t,e){c.set(t,e),this._addFlag(c,n.BODY)},t.prototype.removeBody=function(t,e){c.set(t,e),this._removeFlag(c,n.BODY)},t.prototype.getBody=function(t,e){c.set(t,e);var i=this._size.index(c);return this._tileFlags[i]&n.BODY},t.prototype.getFieldOfView=function(t,e,i){var r=new o.Offset(t,e),n=new o.Rectangle(r.x-i,r.y-i,2*i+1,2*i+1),s=new o.MaskRect(n);return s.set(r,!0),this._quadrant(s,r,i,-1,-1),this._quadrant(s,r,i,1,-1),this._quadrant(s,r,i,-1,1),this._quadrant(s,r,i,1,1),s},t.prototype._quadrant=function(t,e,i,o,c){var f=e.x,a=e.y,p=(Math.min(Math.max(f+o*(i+1),-1),this._size.width)-f)*o,l=(Math.min(Math.max(a+c*(i+1),-1),this._size.height)-a)*c;if(!(p<0||l<0))for(var d=1===c?n.WALL_SOUTH:n.WALL_NORTH,y=1===o?n.WALL_EAST:n.WALL_WEST,g=this._size.index(e),_=t.index(e),O=[0,Number.POSITIVE_INFINITY],b=0,v=g,m=_;b!==l&&O.length>0;b++,v+=c*this._size.width,m+=c*t.width)for(var w=1/(b+.5),T=0===b?Number.POSITIVE_INFINITY:1/(b-.5),x=0,S=0,F=v,W=m,z=-.5*w,A=.5*T;S!==p&&x!==O.length;S++,F+=o,W+=o,z+=w,A+=T){for(;z>=O[x+u]&&!((x+=h)>=O.length););if(x>=O.length)break;if(!(A<=O[x+s])){t.setAt(W,!0);var P=0!=(this._tileFlags[F]&d),E=0!=(this._tileFlags[F]&y);if(E&&P)x=r(O,x,z-1e-5/10,A+1e-5/10);else{var L=(0!==S||0!==b)&&0!=(this._tileFlags[F]&n.BODY);if(L)x=E?r(O,x,z+1e-5,A+1e-5/10):P?r(O,x,z-1e-5/10,A-1e-5):r(O,x,z+1e-5,A-1e-5);else if(E){var j=z+w;x=r(O,x,j-1e-5/10,A+1e-5/10)}else if(P){var j=z+w;x=r(O,x,z-1e-5/10,j+1e-5/10)}}}}},t}();e.FieldOfViewMap=f},function(t,e,i){"use strict";function r(t){var e="[";return 0!=(t&o.NORTH)&&(e+="N"),0!=(t&o.EAST)&&(e+="E"),0!=(t&o.SOUTH)&&(e+="S"),0!=(t&o.WEST)&&(e+="W"),e+"]"}function n(t){return 1<<t}Object.defineProperty(e,"__esModule",{value:!0});var o;!function(t){t[t.NONE=0]="NONE",t[t.NORTH=1]="NORTH",t[t.EAST=2]="EAST",t[t.SOUTH=4]="SOUTH",t[t.WEST=8]="WEST",t[t.ALL=15]="ALL"}(o=e.DirectionFlags||(e.DirectionFlags={})),e.directionFlagsToString=r,e.directionFlagsFromDirection=n},function(t,e,i){"use strict";function r(t){return t+2&3}Object.defineProperty(e,"__esModule",{value:!0});var n;!function(t){t[t.NORTH=0]="NORTH",t[t.EAST=1]="EAST",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST"}(n=e.Direction||(e.Direction={})),e.DIRECTIONS=[n.NORTH,n.EAST,n.SOUTH,n.WEST],e.directionOpposite=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(0),n=new r.Offset,o=function(){function t(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1),this._rectangle=new r.Rectangle,this._rectangle.copyFrom(t),this._mask=new r.Mask(t,e),this._outsideValue=i}return t.prototype.toString=function(){return this._rectangle.northWest+"/"+this._outsideValue+"\n"+this._mask},Object.defineProperty(t.prototype,"westX",{get:function(){return this._rectangle.westX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"northY",{get:function(){return this._rectangle.northY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._rectangle.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._rectangle.height},enumerable:!0,configurable:!0}),t.prototype.index=function(t){return this._mask.index(n.copyFrom(t).subtractOffset(this._rectangle.northWest))},t.prototype.getAt=function(t){return this._mask.getAt(t)},t.prototype.get=function(t,e){return n.set(t,e),this._rectangle.containsOffset(n)?this._mask.get(n.subtractOffset(this._rectangle.northWest)):this._outsideValue},t.prototype.setAt=function(t,e){return this._mask.setAt(t,e),this},t.prototype.set=function(t,e){return this._mask.set(n.copyFrom(t).subtractOffset(this._rectangle.northWest),e),this},t.prototype.forEach=function(t,e){var i=this;this._mask.forEach(t,function(t,r){e(t.addOffset(i._rectangle.northWest),r)})},t}();e.MaskRect=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(0),n=function(){function t(t,e){void 0===e&&(e=!1),this._size=new r.Size,this._size.copyFrom(t),this._bits=new Array(this._size.area).fill(e)}return t.prototype.toString=function(){for(var t="",e=new r.Offset,i=0;i<this._size.height;i++){for(var n=0;n<this._size.width;n++)e.set(n,i),t+=this.get(e.set(n,i))?"☑":"☐";t+="\n"}return t},Object.defineProperty(t.prototype,"width",{get:function(){return this._size.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._size.height},enumerable:!0,configurable:!0}),t.prototype.index=function(t){return this._size.index(t)},t.prototype.getAt=function(t){return this._bits[t]},t.prototype.get=function(t){return this.getAt(this.index(t))},t.prototype.setAt=function(t,e){return this._bits[t]=e,this},t.prototype.set=function(t,e){return this.setAt(this.index(t),e)},t.prototype.forEach=function(t,e){var i=this,r=0;this._size.forEach(t,function(t){e(t,i._bits[r]),r++})},t}();e.Mask=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=[0,1,0,-1],n=[-1,0,1,0],o=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.toString=function(){return"("+this.x+","+this.y+")"},t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.addOffset=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.addCardinalDirection=function(t){return this.x+=r[t],this.y+=n[t],this},t.prototype.subtractOffset=function(t){return this.x-=t.x,this.y-=t.y,this},t}();e.Offset=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(0),n=new r.Offset,o=function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.northWest=new r.Offset(t,e),this.size=new r.Size(i,n)}return t.prototype.toString=function(){return"("+this.westX+","+this.northY+" "+this.width+"x"+this.height+")"},Object.defineProperty(t.prototype,"northY",{get:function(){return this.northWest.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"southY",{get:function(){return this.northWest.y+this.size.height-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"westX",{get:function(){return this.northWest.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eastX",{get:function(){return this.northWest.x+this.size.width-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.size.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.size.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this.size.empty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.size.area},enumerable:!0,configurable:!0}),t.prototype.copyFrom=function(t){return this.northWest.set(t.westX,t.northY),this.size.set(t.width,t.height),this},t.prototype.containsOffset=function(t){return this.size.containsOffset(n.copyFrom(t).subtractOffset(this.northWest))},t.prototype.index=function(t){return this.size.index(n.copyFrom(t).subtractOffset(this.northWest))},t}();e.Rectangle=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.width=t,this.height=e}return t.prototype.toString=function(){return"("+this.width+"x"+this.height+")"},Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.width||0===this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){return this.width=t,this.height=e,this},t.prototype.copyFrom=function(t){return this.width=t.width,this.height=t.height,this},t.prototype.containsOffset=function(t){return t.x>=0&&t.y>=0&&t.x<this.width&&t.y<this.height},t.prototype.index=function(t){return t.y*this.width+t.x},t.prototype.forEach=function(t,e){for(var i=0;i<this.height;i++)for(var r=0;r<this.width;r++)t.x=r,t.y=i,e(t)},t}();e.Size=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(1);e.FieldOfViewMap=r.FieldOfViewMap;var n=i(0);e.Direction=n.Direction,e.DirectionFlags=n.DirectionFlags,e.MaskRect=n.MaskRect}]);
//# sourceMappingURL=wally-fov-0.1.2.min.js.map