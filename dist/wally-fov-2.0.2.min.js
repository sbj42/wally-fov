var WallyFov;(()=>{"use strict";var t={677:(t,i)=>{var e;Object.defineProperty(i,"__esModule",{value:!0}),i.axisAddCardinalTurn=i.axisFromNorthSouthTurn=i.axisFromCardinalDirection=i.axisOrthogonal=i.axisToString=i.AXES=i.Axis=void 0,function(t){t[t.NORTH_SOUTH=0]="NORTH_SOUTH",t[t.WEST_EAST=1]="WEST_EAST"}(e=i.Axis||(i.Axis={})),i.AXES=[e.NORTH_SOUTH,e.WEST_EAST];const r=["N-S","W-E"];i.axisToString=function(t){return r[t]},i.axisOrthogonal=function(t){return 1^t},i.axisFromCardinalDirection=function(t){return 1&t},i.axisFromNorthSouthTurn=function(t){return 1&t},i.axisAddCardinalTurn=function(t,i){return t+i&1}},340:(t,i)=>{var e;function r(t){return 1<<t}Object.defineProperty(i,"__esModule",{value:!0}),i.cardinalDirectionFlagsFromCardinalDirection=i.cardinalDirectionFlagsRemoveCardinalDirection=i.cardinalDirectionFlagsSetCardinalDirection=i.cardinalDirectionFlagsHasCardinalDirection=i.cardinalDirectionFlagsToString=i.CardinalDirectionFlags=void 0,function(t){t[t.NONE=0]="NONE",t[t.NORTH=1]="NORTH",t[t.EAST=2]="EAST",t[t.SOUTH=4]="SOUTH",t[t.WEST=8]="WEST",t[t.ALL=15]="ALL"}(e=i.CardinalDirectionFlags||(i.CardinalDirectionFlags={})),i.cardinalDirectionFlagsToString=function(t){let i="[";return 0!=(t&e.NORTH)&&(i+="N"),0!=(t&e.EAST)&&(i+="E"),0!=(t&e.SOUTH)&&(i+="S"),0!=(t&e.WEST)&&(i+="W"),i+"]"},i.cardinalDirectionFlagsHasCardinalDirection=function(t,i){return 0!=(t&r(i))},i.cardinalDirectionFlagsSetCardinalDirection=function(t,i){return t|r(i)},i.cardinalDirectionFlagsRemoveCardinalDirection=function(t,i){return t&~r(i)},i.cardinalDirectionFlagsFromCardinalDirection=r},343:(t,i)=>{var e;Object.defineProperty(i,"__esModule",{value:!0}),i.cardinalDirectionAddCardinalTurn=i.cardinalDirectionFromCardinalOrientation=i.cardinalDirectionFromNorthTurn=i.cardinalDirectionFromDirection=i.cardinalDirectionOpposite=i.cardinalDirectionToString=i.CARDINAL_DIRECTIONS=i.CardinalDirection=void 0,function(t){t[t.NORTH=0]="NORTH",t[t.EAST=1]="EAST",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST"}(e=i.CardinalDirection||(i.CardinalDirection={})),i.CARDINAL_DIRECTIONS=[e.NORTH,e.EAST,e.SOUTH,e.WEST];const r=["N","E","S","W"];i.cardinalDirectionToString=function(t){return r[t]},i.cardinalDirectionOpposite=function(t){return t+2&3},i.cardinalDirectionFromDirection=function(t){return t>>1},i.cardinalDirectionFromNorthTurn=function(t){return t},i.cardinalDirectionFromCardinalOrientation=function(t){return t>>>1},i.cardinalDirectionAddCardinalTurn=function(t,i){return t+i&3}},852:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.cardinalOrientationAddCardinalTurn=i.cardinalOrientationFromFlipAndCardinalDirection=i.cardinalOrientationReverse=i.cardinalOrientationFlip=i.cardinalOrientationToString=i.CARDINAL_ORIENTATIONS=i.CardinalOrientation=void 0;const r=e(677),n=e(254);var s;!function(t){t[t.HEADS_NORTH=0]="HEADS_NORTH",t[t.TAILS_NORTH=1]="TAILS_NORTH",t[t.HEADS_EAST=2]="HEADS_EAST",t[t.TAILS_EAST=3]="TAILS_EAST",t[t.HEADS_SOUTH=4]="HEADS_SOUTH",t[t.TAILS_SOUTH=5]="TAILS_SOUTH",t[t.HEADS_WEST=6]="HEADS_WEST",t[t.TAILS_WEST=7]="TAILS_WEST"}(s=i.CardinalOrientation||(i.CardinalOrientation={})),i.CARDINAL_ORIENTATIONS=[s.HEADS_NORTH,s.TAILS_NORTH,s.HEADS_EAST,s.TAILS_EAST,s.HEADS_SOUTH,s.TAILS_SOUTH,s.HEADS_WEST,s.TAILS_WEST];const a=["HN","TN","HE","TE","HS","TS","HW","TW"];i.cardinalOrientationToString=function(t){return a[t]},i.cardinalOrientationFlip=function(t,i){return i===r.Axis.NORTH_SOUTH?9-t&7:13-t&7},i.cardinalOrientationReverse=function(t){return t===s.HEADS_EAST?s.HEADS_WEST:t===s.HEADS_WEST?s.HEADS_EAST:t},i.cardinalOrientationFromFlipAndCardinalDirection=function(t,i){return 2*i+(t!==n.Flip.HEADS?1:0)},i.cardinalOrientationAddCardinalTurn=function(t,i){return t+2*i&7}},974:(t,i)=>{var e;Object.defineProperty(i,"__esModule",{value:!0}),i.cardinalTurnAddCardinalTurn=i.cardinalTurnFromTurn=i.cardinalTurnFromCardinalDirections=i.cardinalTurnReverse=i.cardinalTurnToDegrees=i.cardinalTurnToString=i.CARDINAL_TURNS=i.CardinalTurn=void 0,function(t){t[t.NONE=0]="NONE",t[t.RIGHT=1]="RIGHT",t[t.AROUND=2]="AROUND",t[t.LEFT=3]="LEFT"}(e=i.CardinalTurn||(i.CardinalTurn={})),i.CARDINAL_TURNS=[e.NONE,e.RIGHT,e.AROUND,e.LEFT];const r=["T0","T+90","T180","T-90"];i.cardinalTurnToString=function(t){return r[t]},i.cardinalTurnToDegrees=function(t){return 90*t},i.cardinalTurnReverse=function(t){return 4-t&3},i.cardinalTurnFromCardinalDirections=function(t,i){return i-t&3},i.cardinalTurnFromTurn=function(t){return t>>1},i.cardinalTurnAddCardinalTurn=function(t,i){return t+i&3}},588:(t,i)=>{var e;Object.defineProperty(i,"__esModule",{value:!0}),i.directionAddCardinalTurn=i.directionAddTurn=i.directionFromCardinalDirection=i.directionOpposite=i.directionIsCardinal=i.directionToString=i.DIRECTIONS=i.Direction=void 0,function(t){t[t.NORTH=0]="NORTH",t[t.NORTHEAST=1]="NORTHEAST",t[t.EAST=2]="EAST",t[t.SOUTHEAST=3]="SOUTHEAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTHWEST=5]="SOUTHWEST",t[t.WEST=6]="WEST",t[t.NORTHWEST=7]="NORTHWEST"}(e=i.Direction||(i.Direction={})),i.DIRECTIONS=[e.NORTH,e.NORTHEAST,e.EAST,e.SOUTHEAST,e.SOUTH,e.SOUTHWEST,e.WEST,e.NORTHWEST];const r=["N","NE","E","SE","S","SW","W","NW"];i.directionToString=function(t){return r[t]},i.directionIsCardinal=function(t){return 0==(1&t)},i.directionOpposite=function(t){return t+4&7},i.directionFromCardinalDirection=function(t){return t<<1},i.directionAddTurn=function(t,i){return t+i&7},i.directionAddCardinalTurn=function(t,i){return t+2*i&7}},254:(t,i)=>{var e;Object.defineProperty(i,"__esModule",{value:!0}),i.flipFromCardinalOrientation=i.flipFromBoolean=i.flipOpposite=i.flipToString=i.FLIPS=i.Flip=void 0,function(t){t[t.HEADS=0]="HEADS",t[t.TAILS=1]="TAILS"}(e=i.Flip||(i.Flip={})),i.FLIPS=[e.HEADS,e.TAILS];const r=["H","T"];i.flipToString=function(t){return r[t]},i.flipOpposite=function(t){return 1^t},i.flipFromBoolean=function(t){return t?e.TAILS:e.HEADS},i.flipFromCardinalOrientation=function(t){return 1&t}},778:function(t,i,e){var r=this&&this.__createBinding||(Object.create?function(t,i,e,r){void 0===r&&(r=e),Object.defineProperty(t,r,{enumerable:!0,get:function(){return i[e]}})}:function(t,i,e,r){void 0===r&&(r=e),t[r]=i[e]}),n=this&&this.__exportStar||function(t,i){for(var e in t)"default"===e||Object.prototype.hasOwnProperty.call(i,e)||r(i,t,e)};Object.defineProperty(i,"__esModule",{value:!0}),n(e(588),i),n(e(854),i),n(e(343),i),n(e(974),i),n(e(340),i),n(e(254),i),n(e(852),i),n(e(677),i)},854:(t,i)=>{var e;Object.defineProperty(i,"__esModule",{value:!0}),i.turnAddTurn=i.turnFromDirections=i.turnFromCardinalTurn=i.turnFromCardinalDirections=i.turnReverse=i.turnIsCardinal=i.turnToDegrees=i.turnToString=i.TURNS=i.Turn=void 0,function(t){t[t.NONE=0]="NONE",t[t.R_45=1]="R_45",t[t.R_90=2]="R_90",t[t.R_135=3]="R_135",t[t.T_180=4]="T_180",t[t.L_135=5]="L_135",t[t.L_90=6]="L_90",t[t.L_45=7]="L_45"}(e=i.Turn||(i.Turn={})),i.TURNS=[e.NONE,e.R_45,e.R_90,e.R_135,e.T_180,e.L_135,e.L_90,e.L_45];const r=["T0","T+45","T+90","T+135","T180","T-135","T-90","T-45"];i.turnToString=function(t){return r[t]},i.turnToDegrees=function(t){return 45*t},i.turnIsCardinal=function(t){return 0==(1&t)},i.turnReverse=function(t){return 8-t&7},i.turnFromCardinalDirections=function(t,i){return 2*(i-t)&7},i.turnFromCardinalTurn=function(t){return t<<1},i.turnFromDirections=function(t,i){return i-t&7},i.turnAddTurn=function(t,i){return t+i&7}},913:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CardinalPath=void 0;const r=e(778),n=e(894),s=e(84),a=e(37),o=new n.Offset;function h(t,i){t.push(i);let e=t.length-1;for(;e>0&&i<t[e-1];)t[e]=t[e-1],e--;t[e]=i}i.CardinalPath=class{constructor(t,i){this._start=new n.Offset,this._start.copyFrom(t),this._segments=i}toString(){return`${this._start.toString()}:${this._segments.map((t=>r.cardinalDirectionToString(t))).join("")}`}equals(t){return this._start.equals(t._start)&&this._segments.length===t._segments.length&&this._segments.every(((i,e)=>i===t._segments[e]))}get length(){return this._segments.length}getIsClosed(){o.copyFrom(this._start);for(const t of this._segments)o.addCardinalDirection(t);return this._start.equals(o)}*offsets(){let{x:t,y:i}=this._start;yield{x:t,y:i};for(const e of this._segments)o.setFromCardinalDirection(e),t+=o.x,i+=o.y,yield{x:t,y:i}}getBounds(){let t=this._start.y,i=t,e=this._start.x,n=e;o.copyFrom(this._start);for(const s of this._segments)switch(o.addCardinalDirection(s),s){case r.CardinalDirection.NORTH:t=Math.min(t,o.y);break;case r.CardinalDirection.EAST:n=Math.max(n,o.x);break;case r.CardinalDirection.SOUTH:i=Math.max(i,o.y);break;case r.CardinalDirection.WEST:e=Math.min(e,o.x);break;default:throw new Error(`bad direction ${s} in cardinal path`)}return new s.Rectangle(e,t,n-e+1,i-t+1)}getArea(){let t=0;o.copyFrom(this._start);for(const i of this._segments)switch(o.addCardinalDirection(i),i){case r.CardinalDirection.NORTH:t-=o.x;break;case r.CardinalDirection.SOUTH:t+=o.x}return Math.abs(t)}rasterize(t){const i=new Array;void 0===t&&(t=this.getBounds()),o.copyFrom(this._start);const{northY:e}=t,n=e+t.height-1;for(let t=e;t<n;t++)i.push([]);o.copyFrom(this._start);for(const t of this._segments)t===r.CardinalDirection.SOUTH&&h(i[o.y-e],o.x),o.addCardinalDirection(t),t===r.CardinalDirection.NORTH&&h(i[o.y-e],o.x);return new a.RasterMask({westX:t.westX,northY:t.northY,width:t.width-1,height:t.height-1},i)}}},551:function(t,i,e){var r=this&&this.__createBinding||(Object.create?function(t,i,e,r){void 0===r&&(r=e),Object.defineProperty(t,r,{enumerable:!0,get:function(){return i[e]}})}:function(t,i,e,r){void 0===r&&(r=e),t[r]=i[e]}),n=this&&this.__exportStar||function(t,i){for(var e in t)"default"===e||Object.prototype.hasOwnProperty.call(i,e)||r(i,t,e)};Object.defineProperty(i,"__esModule",{value:!0}),n(e(894),i),n(e(925),i),n(e(84),i),n(e(475),i),n(e(12),i),n(e(37),i),n(e(913),i),n(e(917),i)},12:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.MaskRectangle=void 0;const r=e(84),n=e(475);i.MaskRectangle=class{constructor(t,i=!1,e=!1){this._rect=new r.Rectangle,void 0!==t&&this._rect.copyFrom(t),this._mask=new n.Mask(t,i),this._outsideValue=e}toString(){return`${this._rect.northWest}/${this._outsideValue}\n${this._mask}`}equals(t){return this._rect.equals(t._rect)&&this._mask.equals(t._mask)&&this._outsideValue===t._outsideValue}get westX(){return this._rect.westX}get northY(){return this._rect.northY}get width(){return this._rect.width}get height(){return this._rect.height}get(t,i){return this._rect.contains(t,i)?this._mask.get(t-this.westX,i-this.northY):this._outsideValue}getAtIndex(t){return this._mask.getAtIndex(t)}getAtOffset(t){return this.get(t.x,t.y)}copyFrom(t){return this._rect.copyFrom(t._rect),this._mask.copyFrom(t._mask),this._outsideValue=t._outsideValue,this}set(t,i,e){return this._mask.set(t-this.westX,i-this.northY,e),this}setAtOffset(t,i){return this.set(t.x,t.y,i)}setAtIndex(t,i){return this._mask.setAtIndex(t,i),this}index(t,i){return this._mask.index(t-this.westX,i-this.northY)}*locations(){for(const t of this._mask.locations()){const i=t.x+this.westX,e=t.y+this.northY,{value:r}=t;yield{x:i,y:e,value:r}}}*offsetsWithTrue(){for(const t of this._mask.offsetsWithTrue()){const i=t.x+this.westX,e=t.y+this.northY;yield{x:i,y:e}}}}},475:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Mask=void 0;const r=e(925);i.Mask=class{constructor(t,i=!1){this._size=new r.Size,void 0!==t&&this._size.copyFrom(t),this._bits=new Array(Math.ceil(this._size.area/32)).fill(i?4294967295:0)}toString(){let t="";for(let i=0;i<this.height;i++){for(let e=0;e<this.width;e++)t+=this.get(e,i)?"☑":"☐";t+="\n"}return t}equals(t){return this._size.equals(t._size)&&this._bits.length===t._bits.length&&this._bits.every(((i,e)=>i===t._bits[e]))}get width(){return this._size.width}get height(){return this._size.height}get(t,i){return this.getAtIndex(this.index(t,i))}getAtOffset(t){return this.get(t.x,t.y)}getAtIndex(t){const i=t>>>5,e=1<<(31&t);return 0!=(this._bits[i]&e)}copyFrom(t){return this._size.copyFrom(t._size),this._bits=t._bits.slice(),this}set(t,i,e){return this.setAtIndex(this.index(t,i),e)}setAtOffset(t,i){return this.set(t.x,t.y,i)}setAtIndex(t,i){const e=t>>>5,r=1<<(31&t);return i?this._bits[e]|=r:this._bits[e]&=~r,this}index(t,i){return this._size.index(t,i)}*locations(){let t=0,i=1;for(const{x:e,y:r}of this._size.offsets()){const n=0!=(this._bits[t]&i);yield{x:e,y:r,value:n},i===1<<31?(i=1,t++):i<<=1}}*offsetsWithTrue(){for(const{x:t,y:i,value:e}of this.locations())e&&(yield{x:t,y:i})}}},894:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Offset=void 0;const r=e(778),n=[0,1,1,1,0,-1,-1,-1],s=[-1,-1,0,1,1,1,0,-1],a=[0,1,0,-1],o=[-1,0,1,0];i.Offset=class{constructor(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i}toString(){return`(${this.x},${this.y})`}equals(t){return this.x===t.x&&this.y===t.y}set(t,i){return this.x=t,this.y=i,this}copyFrom(t){return this.set(t.x,t.y)}setFromDirection(t){return this.set(n[t],s[t])}setFromCardinalDirection(t){return this.set(a[t],o[t])}add(t,i){return this.x+=t,this.y+=i,this}addSize(t){return this.add(t.width,t.height)}addOffset(t){return this.add(t.x,t.y)}addDirection(t){return this.add(n[t],s[t])}addCardinalDirection(t){return this.add(a[t],o[t])}subtractOffset(t){return this.add(-t.x,-t.y)}multiply(t){return this.x*=t,this.y*=t,this}rotate(t,i){if(i)return this.subtractOffset(i).rotate(t).addOffset(i);{const i=r.cardinalDirectionFromNorthTurn(t),{x:e,y:n}=this,s=a[i],h=o[i],l=-n*s-e*h,c=e*s-n*h;return this.set(l,c)}}distanceChebyshev(t){return Math.max(Math.abs(this.x-t.x),Math.abs(this.y-t.y))}distanceManhattan(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}*nearbyChebyshevOffsets(t,i){if(i>=0)for(let e=-i;e<=i;e++)for(let r=-i;r<=i;r++)yield t.set(this.x+r,this.y+e)}}},37:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.RasterMask=void 0;const r=e(84);i.RasterMask=class{constructor(t,i){if(this._rect=new r.Rectangle,i.length!==t.height)throw new Error(`bad lines array length ${i.length} for bounds ${t}`);this._rect.copyFrom(t),this._lines=i}toString(){let t="";const{eastX:i}=this._rect;for(let e=0;e<this.height;e++){const r=this._lines[e];let n=this.westX;for(let i=0;i<r.length;i+=2){const e=r[i],s=r[i+1];for(;n<e;)t+="∙",n++;for(;n<s;)t+="█",n++}for(;n<=i;)t+="∙",n++;t+="\n"}return`(${this._rect.westX},${this._rect.northY})\n${t}`}equals(t){return this._rect.equals(t._rect)&&this._lines.length===t._lines.length&&this._lines.every(((i,e)=>i.length===t._lines[e].length&&i.every(((i,r)=>i===t._lines[e][r]))))}get northY(){return this._rect.northY}get southY(){return this._rect.southY}get westX(){return this._rect.westX}get width(){return this._rect.width}get height(){return this._rect.height}get(t,i){if(i<this.northY||i>this._rect.southY)return!1;const e=this._lines[i-this.northY];for(let i=0;i<e.length;i+=2)if(t>=e[i]&&t<e[i+1])return!0;return!1}getAtOffset(t){return this.get(t.x,t.y)}*bandsAt(t){if(t>=this.northY&&t<=this._rect.southY){const i=this._lines[t-this.northY];for(let t=0;t<i.length;t+=2)yield{westX:i[t],eastX:i[t+1]-1}}}}},84:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Rectangle=void 0;const r=e(925),n=e(894),s=[0,0,1,1],a=[0,1,1,0];i.Rectangle=class{constructor(t,i,e,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===e&&(e=0),void 0===s&&(s=0),this.northWest=new n.Offset(t,i),this.size=new r.Size(e,s)}toString(){return`(${this.westX},${this.northY} ${this.width}x${this.height})`}equals(t){return this.westX===t.westX&&this.northY===t.northY&&this.size.equals(t)}get northY(){return this.northWest.y}get southY(){return this.northWest.y+this.size.height-1}get westX(){return this.northWest.x}get eastX(){return this.northWest.x+this.size.width-1}get width(){return this.size.width}get height(){return this.size.height}get empty(){return this.size.empty}get area(){return this.size.area}set(t,i,e,r){return this.northWest.set(t,i),this.size.set(e,r),this}setFromCorners(t,i){const e=Math.min(t.x,i.x),r=Math.max(t.x,i.x),n=Math.min(t.y,i.y),s=Math.max(t.y,i.y);return this.set(e,n,r-e+1,s-n+1)}copyFrom(t){return this.set(t.westX,t.northY,t.width,t.height)}addOffset(t){return this.northWest.addOffset(t),this}scale(t){return this.northWest.multiply(t),this.size.multiply(t),this}rotate(t,i){const e=s[t],r=a[t];return this.northWest.add(e*(this.width-1),r*(this.height-1)).rotate(t,i),this.size.rotate(t),this}extendToInclude(t){const i=t.x-this.westX;i<0?(this.size.width-=i,this.northWest.x=t.x):i>=this.size.width&&(this.size.width=i+1);const e=t.y-this.northWest.y;return e<0?(this.size.height-=e,this.northWest.y=t.y):e>=this.size.height&&(this.size.height=e+1),this}contains(t,i){return this.size.contains(t-this.westX,i-this.northY)}index(t,i){return this.size.index(t-this.westX,i-this.northY)}containsOffset(t){return this.contains(t.x,t.y)}containsRectangle(t){if(0===t.width&&0===t.height)return!1;const i=t.westX-this.westX,e=t.northY-this.northY;return!!this.size.contains(i,e)&&this.size.contains(i+t.width-1,e+t.height-1)}overlapsRectangle(t){return this.northY<=t.northY+t.height-1&&this.southY>=t.northY&&this.westX<=t.westX+t.width-1&&this.eastX>=t.westX&&!this.empty&&0!==t.width&&0!==t.height}*offsets(){const{eastX:t,southY:i}=this;for(let e=this.northY;e<=i;e++)for(let i=this.westX;i<=t;i++)yield{x:i,y:e}}anyOf(t){for(const{x:i,y:e}of this.offsets())if(t(i,e))return!0;return!1}}},925:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Size=void 0;const r=e(778);i.Size=class{constructor(t,i){if(void 0===t&&(t=0),void 0===i&&(i=0),t<0||i<0)throw new Error(`bad size (${t}x${i})`);this.width=t,this.height=i}toString(){return`(${this.width}x${this.height})`}equals(t){return this.width===t.width&&this.height===t.height}get empty(){return 0===this.width||0===this.height}get area(){return this.width*this.height}set(t,i){if(t<0||i<0)throw new Error(`bad size (${t}x${i})`);return this.width=t,this.height=i,this}copyFrom(t){return this.set(t.width,t.height)}add(t,i){return this.width+=t,this.height+=i,this}multiply(t){return this.width*=t,this.height*=t,this}rotate(t){return r.axisFromNorthSouthTurn(t)===r.Axis.WEST_EAST&&this.set(this.height,this.width),this}contains(t,i){return t>=0&&i>=0&&t<this.width&&i<this.height}containsOffset(t){return this.contains(t.x,t.y)}index(t,i){return i*this.width+t}*offsets(){for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)yield{x:i,y:t}}anyOf(t){for(const{x:i,y:e}of this.offsets())if(t(i,e))return!0;return!1}}},917:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TransformRectangle=void 0;const r=e(84),n=e(778),s=e(894),a=e(925),o=new s.Offset,h=new s.Offset,l=new a.Size;i.TransformRectangle=class{constructor(t,i){this._size=new a.Size,this._flip=n.Flip.HEADS,this._rotate=n.CardinalTurn.NONE,this._translate=new s.Offset,this._matrix=[1,0,0,0,1,0],this._targetRect=new r.Rectangle,void 0===t||("number"==typeof t?this._size.set(t,i):this._size.copyFrom(t)),this._update()}toString(){return`[${this._size} -> ${n.flipToString(this._flip)} ${n.cardinalTurnToString(this._rotate)} ${this._translate} -> ${this._targetRect}]`}equals(t){return this._size.equals(t._size)&&this._flip===t._flip&&this._rotate===t._rotate&&this._translate.equals(t._translate)}get flip(){return this._flip}get rotate(){return this._rotate}get northY(){return this._translate.y}get southY(){return this._translate.y+this._targetRect.height-1}get westX(){return this._translate.x}get eastX(){return this._translate.x+this._targetRect.width-1}get width(){return this._targetRect.width}get height(){return this._targetRect.height}_update(){o.setFromCardinalDirection(n.cardinalDirectionFromNorthTurn(this._rotate));const t=this._flip===n.Flip.TAILS?-1:1;switch(this._matrix[0]=-o.y*t,this._matrix[1]=-o.x,this._matrix[2]=this._translate.x,this._matrix[3]=o.x*t,this._matrix[4]=-o.y,this._matrix[5]=this._translate.y,this._rotate){case n.CardinalTurn.NONE:this._flip===n.Flip.TAILS&&(this._matrix[2]+=this._size.width-1);break;case n.CardinalTurn.RIGHT:this._matrix[2]+=this._size.height-1,this._flip===n.Flip.TAILS&&(this._matrix[5]+=this._size.width-1);break;case n.CardinalTurn.AROUND:this._matrix[5]+=this._size.height-1,this._flip===n.Flip.HEADS&&(this._matrix[2]+=this._size.width-1);break;case n.CardinalTurn.LEFT:this._flip===n.Flip.HEADS&&(this._matrix[5]+=this._size.width-1)}return l.copyFrom(this._size).rotate(this._rotate),this._targetRect.set(this._translate.x,this._translate.y,l.width,l.height),this}copyFrom(t){return this._size.copyFrom(t._size),this._flip=t._flip,this._rotate=t._rotate,this._translate.copyFrom(t._translate),t._matrix.forEach(((t,i)=>this._matrix[i]=t)),this._targetRect.copyFrom(t._targetRect),this}reset(){return this._flip=n.Flip.HEADS,this._rotate=n.CardinalTurn.NONE,this._translate.set(0,0),this._update()}invert(){const t=n.cardinalTurnFromCardinalDirections(n.CardinalDirection.NORTH,n.cardinalDirectionFromCardinalOrientation(n.cardinalOrientationReverse(n.cardinalOrientationFromFlipAndCardinalDirection(this._flip,n.cardinalDirectionFromNorthTurn(this._rotate)))));return this._rotate=t,this._size.rotate(t),this._translate.multiply(-1),this._update()}setTransform(t,i,e){return this._flip=t,this._rotate=i,this._translate.copyFrom(e),this._update()}setFlip(t){return this._flip=t,this._update()}setRotate(t){return this._rotate=t,this._update()}setTranslate(t,i){return this._translate.set(t,i),this._update()}setTranslateOffset(t){return this._translate.copyFrom(t),this._update()}applyToCardinalOrientation(t){return this._flip===n.Flip.TAILS&&(t=n.cardinalOrientationFlip(t,n.Axis.NORTH_SOUTH)),n.cardinalOrientationAddCardinalTurn(t,this._rotate)}unapplyFromCardinalOrientation(t){return t=n.cardinalOrientationAddCardinalTurn(t,n.cardinalTurnReverse(this._rotate)),this._flip===n.Flip.TAILS&&(t=n.cardinalOrientationFlip(t,n.Axis.NORTH_SOUTH)),t}applyToCardinalDirection(t){return n.cardinalDirectionFromCardinalOrientation(this.applyToCardinalOrientation(n.cardinalOrientationFromFlipAndCardinalDirection(n.Flip.HEADS,t)))}unapplyFromCardinalDirection(t){return n.cardinalDirectionFromCardinalOrientation(this.unapplyFromCardinalOrientation(n.cardinalOrientationFromFlipAndCardinalDirection(n.Flip.HEADS,t)))}applyTo(t,i,e){const r=i*this._matrix[0]+e*this._matrix[1]+this._matrix[2],n=i*this._matrix[3]+e*this._matrix[4]+this._matrix[5];return t.set(r,n)}unapplyFrom(t,i,e){const r=i-this._matrix[2],n=e-this._matrix[5],s=r*this._matrix[0]+n*this._matrix[3],a=r*this._matrix[1]+n*this._matrix[4];return t.set(s,a)}applyToOffset(t,i){return void 0===i&&(i=t),this.applyTo(t,i.x,i.y)}unapplyFromOffset(t,i){return void 0===i&&(i=t),this.unapplyFrom(t,i.x,i.y)}applyToRectangle(t,i){return void 0!==i&&t.copyFrom(i),o.set(t.westX,t.northY),h.set(t.eastX,t.southY),this.applyToOffset(o),this.applyToOffset(h),t.setFromCorners(o,h)}unapplyFromRectangle(t,i){return void 0!==i&&t.copyFrom(i),o.set(t.westX,t.northY),h.set(t.eastX,t.southY),this.unapplyFromOffset(o),this.unapplyFromOffset(h),t.setFromCorners(o,h)}}},841:function(t,i,e){var r=this&&this.__createBinding||(Object.create?function(t,i,e,r){void 0===r&&(r=e),Object.defineProperty(t,r,{enumerable:!0,get:function(){return i[e]}})}:function(t,i,e,r){void 0===r&&(r=e),t[r]=i[e]}),n=this&&this.__exportStar||function(t,i){for(var e in t)"default"===e||Object.prototype.hasOwnProperty.call(i,e)||r(i,t,e)};Object.defineProperty(i,"__esModule",{value:!0}),n(e(778),i),n(e(551),i)},695:function(t,i,e){var r=this&&this.__createBinding||(Object.create?function(t,i,e,r){void 0===r&&(r=e),Object.defineProperty(t,r,{enumerable:!0,get:function(){return i[e]}})}:function(t,i,e,r){void 0===r&&(r=e),t[r]=i[e]}),n=this&&this.__setModuleDefault||(Object.create?function(t,i){Object.defineProperty(t,"default",{enumerable:!0,value:i})}:function(t,i){t.default=i}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)"default"!==e&&Object.prototype.hasOwnProperty.call(t,e)&&r(i,t,e);return n(i,t),i};Object.defineProperty(i,"__esModule",{value:!0}),i.computeFieldOfView=void 0;const a=s(e(841)),o=s(e(601)),h=e(550),l=e(702),c=e(720);function u(t,i,e,r,n,s){const{x:a,y:h}=e,u=(Math.min(Math.max(a+n*(r+1),-1),t.width)-a)*n,d=(Math.min(Math.max(h+s*(r+1),-1),t.height)-h)*s;if(u<0||d<0)return;const _=1===s?l.TileFlags.WALL_SOUTH:l.TileFlags.WALL_NORTH,f=1===n?l.TileFlags.WALL_EAST:l.TileFlags.WALL_WEST,T=t.index(e.x,e.y),g=i.visible.index(e.x,e.y);let O=c.initWedges();for(let e=0,r=T,a=g;e!==d&&O.length>0;e++,r+=s*t.width,a+=s*i.visible.width){const s=1/(e+.5),h=0===e?Number.POSITIVE_INFINITY:1/(e-.5);let d=0;for(let T=0,g=r,p=a,S=-.5*s,y=.5*h;T!==u&&d!==O.length;T++,g+=n,p+=n,S+=s,y+=h){for(;S>O[d].high&&(d++,!(d>=O.length)););if(d>=O.length)break;if(y<O[d].low)continue;i.visible.setAtIndex(p,!0);const r=0!=(t.getTileFlagsAtIndex(g)&_),n=0!=(t.getTileFlagsAtIndex(g)&f);if(n&&r)O=c.cutWedges(O,S-o.WALL_OUTSET,y+o.WALL_OUTSET);else if(0===T&&0===e||0==(t.getTileFlagsAtIndex(g)&l.TileFlags.BODY)){if(n){const t=S+s;O=c.cutWedges(O,t-o.WALL_OUTSET,y+o.WALL_OUTSET)}else if(r){const t=S+s;O=c.cutWedges(O,S-o.WALL_OUTSET,t+o.WALL_OUTSET)}}else O=n?c.cutWedges(O,S+o.BODY_INSET,y+o.WALL_OUTSET):r?c.cutWedges(O,S-o.WALL_OUTSET,y-o.BODY_INSET):c.cutWedges(O,S+o.BODY_INSET,y-o.BODY_INSET)}}}i.computeFieldOfView=function(t,i,e,r){const n=new a.Offset(i,e),s=new h.FieldOfViewImpl(n,r);return u(t,s,n,r,-1,-1),u(t,s,n,r,1,-1),u(t,s,n,r,-1,1),u(t,s,n,r,1,1),s}},601:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WEDGE_COUNT=i.WEDGE_HIGH=i.WEDGE_LOW=i.WALL_OUTSET=i.BODY_INSET=void 0,i.BODY_INSET=1e-5,i.WALL_OUTSET=i.BODY_INSET/4,i.WEDGE_LOW=0,i.WEDGE_HIGH=1,i.WEDGE_COUNT=2},550:function(t,i,e){var r=this&&this.__createBinding||(Object.create?function(t,i,e,r){void 0===r&&(r=e),Object.defineProperty(t,r,{enumerable:!0,get:function(){return i[e]}})}:function(t,i,e,r){void 0===r&&(r=e),t[r]=i[e]}),n=this&&this.__setModuleDefault||(Object.create?function(t,i){Object.defineProperty(t,"default",{enumerable:!0,value:i})}:function(t,i){t.default=i}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)"default"!==e&&Object.prototype.hasOwnProperty.call(t,e)&&r(i,t,e);return n(i,t),i};Object.defineProperty(i,"__esModule",{value:!0}),i.FieldOfViewImpl=void 0;const a=s(e(841));i.FieldOfViewImpl=class{constructor(t,i){this.origin=t,this.chebyshevRadius=i;const e=new a.Rectangle(t.x-i,t.y-i,2*i+1,2*i+1);this.visible=new a.MaskRectangle(e),this.visible.setAtOffset(t,!0)}getVisible(t,i){return this.visible.get(t,i)}toString(){let t="";for(const i of this.visible.locations()){const{x:e,y:r}=i;this.origin.equals(i)?t+="@":this.getVisible(e,r)?t+="-":t+=".",e===this.visible.westX+this.visible.width-1&&(t+="\n")}return t}}},60:function(t,i,e){var r=this&&this.__createBinding||(Object.create?function(t,i,e,r){void 0===r&&(r=e),Object.defineProperty(t,r,{enumerable:!0,get:function(){return i[e]}})}:function(t,i,e,r){void 0===r&&(r=e),t[r]=i[e]}),n=this&&this.__setModuleDefault||(Object.create?function(t,i){Object.defineProperty(t,"default",{enumerable:!0,value:i})}:function(t,i){t.default=i}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)"default"!==e&&Object.prototype.hasOwnProperty.call(t,e)&&r(i,t,e);return n(i,t),i};Object.defineProperty(i,"__esModule",{value:!0}),i.FieldOfViewMap=void 0;const a=s(e(841)),o=e(702),h=new a.Offset;i.FieldOfViewMap=class{constructor(t,i){this._size=new a.Size,this._size.set(t,i),this._tileFlags=new Array(this._size.area).fill(0)}get width(){return this._size.width}get height(){return this._size.height}addBody(t,i){return this._addFlag(t,i,o.TileFlags.BODY),this}removeBody(t,i){return this._removeFlag(t,i,o.TileFlags.BODY),this}getBody(t,i){const e=this.index(t,i);return 0!=(this.getTileFlagsAtIndex(e)&o.TileFlags.BODY)}addWall(t,i,e){return this._size.contains(t,i)&&(this._addFlag(t,i,1<<e),h.set(t,i),h.addCardinalDirection(e),this._size.containsOffset(h)&&this._addFlag(h.x,h.y,1<<a.cardinalDirectionOpposite(e))),this}removeWall(t,i,e){return this._size.contains(t,i)&&(this._removeFlag(t,i,1<<e),h.set(t,i),h.addCardinalDirection(e),this._size.containsOffset(h)&&this._removeFlag(h.x,h.y,1<<a.cardinalDirectionOpposite(e))),this}getWalls(t,i){const e=this.index(t,i);return o.cardinalDirectionFlagsFromTileFlags(this.getTileFlagsAtIndex(e))}getWall(t,i,e){const r=this.index(t,i);return 0!=(this.getTileFlagsAtIndex(r)&o.tileFlagsForWallAtCardinalDirection(e))}index(t,i){return this._size.index(t,i)}_addFlag(t,i,e){const r=this._size.index(t,i);this._tileFlags[r]|=e}_removeFlag(t,i,e){const r=this._size.index(t,i);this._tileFlags[r]&=~e}getTileFlagsAtIndex(t){return this._tileFlags[t]}}},702:function(t,i,e){var r=this&&this.__createBinding||(Object.create?function(t,i,e,r){void 0===r&&(r=e),Object.defineProperty(t,r,{enumerable:!0,get:function(){return i[e]}})}:function(t,i,e,r){void 0===r&&(r=e),t[r]=i[e]}),n=this&&this.__setModuleDefault||(Object.create?function(t,i){Object.defineProperty(t,"default",{enumerable:!0,value:i})}:function(t,i){t.default=i}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)"default"!==e&&Object.prototype.hasOwnProperty.call(t,e)&&r(i,t,e);return n(i,t),i};Object.defineProperty(i,"__esModule",{value:!0}),i.tileFlagsHasCardinalDirection=i.cardinalDirectionFlagsFromTileFlags=i.tileFlagsForWallAtCardinalDirection=i.TileFlags=void 0;const a=s(e(841));function o(t){return t&a.CardinalDirectionFlags.ALL}var h;(h=i.TileFlags||(i.TileFlags={}))[h.NONE=0]="NONE",h[h.WALL_NORTH=1]="WALL_NORTH",h[h.WALL_EAST=2]="WALL_EAST",h[h.WALL_WEST=8]="WALL_WEST",h[h.WALL_SOUTH=4]="WALL_SOUTH",h[h.BODY=1<<a.CARDINAL_DIRECTIONS.length]="BODY",i.tileFlagsForWallAtCardinalDirection=function(t){return a.cardinalDirectionFlagsFromCardinalDirection(t)},i.cardinalDirectionFlagsFromTileFlags=o,i.tileFlagsHasCardinalDirection=function(t,i){return a.cardinalDirectionFlagsHasCardinalDirection(o(t),i)}},720:(t,i)=>{function e(t,i,e){let r;if(i<=t.low)e>=t.high?r=[]:e>=t.low?(t.low=e,r=[t]):r=[t];else if(e>=t.high)i<=t.high?(t.high=i,r=[t]):r=[t];else{const n={low:e,high:t.high};t.high=i,r=[t,n]}return r}Object.defineProperty(i,"__esModule",{value:!0}),i.cutWedges=i.cutWedge=i.initWedges=void 0,i.initWedges=function(){return[{low:0,high:Number.POSITIVE_INFINITY}]},i.cutWedge=e,i.cutWedges=function(t,i,r){const n=new Array;for(const s of t)n.push(...e(s,i,r));return n}}},i={};function e(r){var n=i[r];if(void 0!==n)return n.exports;var s=i[r]={exports:{}};return t[r].call(s.exports,s,s.exports,e),s.exports}var r={};(()=>{var t=r;Object.defineProperty(t,"__esModule",{value:!0}),t.CardinalDirectionFlags=t.CardinalDirection=t.computeFieldOfView=t.FieldOfViewMap=void 0;var i=e(60);Object.defineProperty(t,"FieldOfViewMap",{enumerable:!0,get:function(){return i.FieldOfViewMap}});var n=e(695);Object.defineProperty(t,"computeFieldOfView",{enumerable:!0,get:function(){return n.computeFieldOfView}});var s=e(841);Object.defineProperty(t,"CardinalDirection",{enumerable:!0,get:function(){return s.CardinalDirection}}),Object.defineProperty(t,"CardinalDirectionFlags",{enumerable:!0,get:function(){return s.CardinalDirectionFlags}})})(),WallyFov=r})();
//# sourceMappingURL=wally-fov-2.0.2.min.js.map